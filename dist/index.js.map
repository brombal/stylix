{"version":3,"file":"index.js","sources":["../src/index.tsx"],"sourcesContent":["import { create } from 'nano-css';\nimport { addon as addonCache } from 'nano-css/addon/cache';\nimport { addon as addonDrule } from 'nano-css/addon/drule';\nimport { addon as addonNesting } from 'nano-css/addon/nesting';\nimport { addon as addonPrefixer } from 'nano-css/addon/prefixer';\nimport { addon as addonRule } from 'nano-css/addon/rule';\nimport { addon as addonStable } from 'nano-css/addon/stable';\nimport { addon as addonUnitless } from 'nano-css/addon/unitless';\nimport React, { CSSProperties } from 'react';\nimport htmlTags from './html-tags.json';\nimport cssPropertyNames from './css-props.json';\nimport { StylixComponentType, StylixProps } from './types';\n\nconst nano = create({\n  pfx: 'stylix',\n});\n\nfunction myplugin(renderer) {\n  const origPut = renderer.put;\n  const cache = {};\n  renderer.put = (selector, decls, atrule) => {\n    const cacheKey = atrule ? `${atrule}{${selector}}` : selector;\n    if (cache[cacheKey]) {\n      return;\n    }\n    cache[cacheKey] = true;\n    origPut(selector, decls, atrule);\n  };\n}\n\naddonCache(nano);\naddonRule(nano);\naddonDrule(nano);\naddonUnitless(nano);\naddonPrefixer(nano);\naddonStable(nano);\naddonNesting(nano);\nmyplugin(nano);\n\ntype ClassifiedProps = {\n  styles: CSSProperties;\n  advanced: any;\n  other: any;\n};\n\nfunction classifyProps(props: StylixProps<any>): ClassifiedProps {\n  const values: ClassifiedProps = {\n    styles: {},\n    advanced: {},\n    other: {},\n  };\n\n  Object.keys(props).forEach((key) => {\n    if (cssPropertyNames.includes(key)) {\n      values.styles[key] = props[key];\n    } else if (key[0] === '@' || key.includes('&')) {\n      values.advanced[key] = props[key];\n    } else {\n      values.other[key] = props[key];\n    }\n  });\n\n  return values;\n}\n\nfunction createRule(ref, styles) {\n  if (!ref.current) {\n    ref.current = nano.drule(styles);\n    return ref.current();\n  } else {\n    return ref.current(styles);\n  }\n}\n\nconst Stylix: (<ElType extends React.ElementType = 'div'>(props: StylixProps<ElType>) => any) & {\n  displayName?: string;\n  __isStylix?: true;\n} = React.forwardRef(function Stylix<ElType extends React.ElementType = 'div'>(\n  props: StylixProps<ElType>,\n  ref,\n) {\n  const {\n    $el: El = 'div',\n    $disable,\n    $enable,\n    $media,\n    $selector,\n    $inject,\n    $injected,\n    className,\n    children,\n    ...rest\n  } = props;\n\n  const styleProps = classifyProps(rest);\n\n  let enabled = true;\n  if ('$enable' in props && !props.$enable) enabled = false;\n  if ('$disable' in props && props.$disable) enabled = false;\n\n  const druleRef = React.useRef<any>();\n\n  // If injecting, iterate over children\n  if ($inject || $media) {\n    const styles: any = { ...styleProps.advanced };\n    // If media or selector props were given, nest the styles into the correct structure\n    if ($media && $selector) {\n      styles[`@media ${$media}`] = { [$selector]: styleProps.styles };\n    } else if ($media) {\n      styles[`@media ${$media}`] = styleProps.styles;\n    } else if ($selector) {\n      styles[$selector] = styleProps.styles;\n    }\n\n    return (\n      <>\n        {React.Children.map(children, (child) => {\n          if (!child.type) throw new Error(\"Sorry, you can't $inject styles to a child text node.\");\n          if (child.type.__isStylix) {\n            // If it's another Stylix component, just inject the style props.\n            // If this element isn't enabled, just pass the inherited style props.\n            return React.cloneElement(child, {\n              $injected: enabled ? { ...styles, ...$injected } : $injected,\n              ref,\n            });\n          } else {\n            // If it's a regular html element or other component, just generate a className.\n            const generatedClass = createRule(druleRef, {\n              ...(enabled ? styles : {}),\n              ...$injected,\n            });\n            return React.cloneElement(child, {\n              className: [generatedClass || '', child.props.className || ''].join(' '),\n              ref,\n            });\n          }\n        })}\n      </>\n    );\n  }\n\n  // If not injecting, create an element and pass the merged class names\n\n  if ($selector) {\n    Object.assign(styleProps.advanced, { [$selector]: styleProps.styles });\n    styleProps.styles = {};\n  }\n\n  const generatedClass = enabled\n    ? createRule(druleRef, { ...styleProps.styles, ...styleProps.advanced, ...$injected })\n    : '';\n\n  return (\n    <El\n      className={[generatedClass || '', className || ''].join(' ').trim()}\n      ref={ref}\n      {...styleProps.other}\n    >\n      {children}\n    </El>\n  );\n});\n\nStylix.displayName = 'Stylix';\n\nStylix.__isStylix = true;\n\nfor (const i in htmlTags) {\n  const tag = htmlTags[i];\n  const htmlComponent: StylixComponentType<any> = (props) => <Stylix $el={tag} {...props} />;\n  htmlComponent.displayName = 'Stylix.' + htmlTags[i];\n  htmlComponent.__isStylix = true;\n  Stylix[tag] = htmlComponent;\n}\n\nexport default Stylix;\n"],"names":["nano","create","pfx","myplugin","renderer","origPut","put","cache","selector","decls","atrule","cacheKey","addonCache","addonRule","addonDrule","addonUnitless","addonPrefixer","addonStable","addonNesting","classifyProps","props","values","styles","advanced","other","Object","keys","forEach","key","cssPropertyNames","includes","createRule","ref","current","drule","Stylix","React","forwardRef","$el","El","$media","$selector","$inject","$injected","className","children","rest","styleProps","enabled","$enable","$disable","druleRef","useRef","Children","map","child","type","Error","__isStylix","cloneElement","generatedClass","join","assign","trim","displayName","i","htmlTags","tag","htmlComponent"],"mappings":"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"}