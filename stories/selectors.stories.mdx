import { Meta, Story, Preview } from '@storybook/addon-docs/blocks';
import $ from '../';

<Meta title="Custom selectors" />

# Selectors

The `$selector` prop allows you to apply styles to **all descendant elements** that match the given
CSS selector. The selector is simply appended (with a space) to the generated class name for the
element.

Any valid CSS selector is supported, including child/sibling selectors (`>`, `+`, `~`) and pseudo
classes (subject to browser support). Comma-separated selectors are also allowed, and the ampersand
`&` can be used to refer to the current element (useful for matching elements other than
descendants).

You can also combine `$selector` and `$inject` to apply the selector rules to child elements
instead. This creates a powerful but simple way to create complex style queries.

You can also use `&` to refer to the Stylix element itself. This is useful with pseudo classes
because `$selector=":last-child"` will match _all descendant elements that are the last child of
their parent_, while `$selector="&:last-child"` will match _the current element if it is the last
child of the its parent_. Think of it as the difference between `.xyz :last-child` and
`.xyz:last-child`.

## Basic selector

Remember that selectors match with _all descendants of the current element_ by default.

For example, `<Stylix $selector="span" ...>` would apply the styles to any `<span>` descendant of
this element (i.e. if this element's generated classname were `xyz`, the full selector would
be `.xyz span`).

`$selector="section"` - All descendant `<section>` elements.

<Preview>
  <Story name="Basic selector">
    <pre>
      <$ $selector="section" color="green">
        <div>{`❌ child <div>`}</div>
        <section>{`✅ child <section>`}</section>
        <$ padding={10} background="#EEE">
          <div>{`❌ descendant <div>`}</div>
          <section>{`✅ descendant <section>`}</section>
        </$>
        <section>{`✅ child <section>`}</section>
      </$>
    </pre>
  </Story>
</Preview>

## Child & sibling selectors

Because the selector is simply treated as space-delimited addition to the class name, you can use
`>`, `+` and `~` to match immediate children and siblings of the current element.

`$selector="> section"` - Immediate child `<section>` elements.

<Preview>
  <Story name="Child selector">
    <pre>
      <$ $selector="> section" color="green">
        <div>{`❌ child <div>`}</div>
        <section>{`✅ child <section>`}</section>
        <$ padding={10} background="#EEE">
          <div>{`❌ descendant <div>`}</div>
          <section>{`❌ descendant <section>`}</section>
        </$>
        <section>{`✅ child <section>`}</section>
      </$>
    </pre>
  </Story>
</Preview>

`$selector="div + section"` - All descendant `<section>` elements that immediately follow `<div>`
elements

<Preview>
  <Story name="Descendant sibling selector">
    <$ $selector="div + section" color="green">
      <section>black text (section preceding div)</section>
      <div>black text (div)</div>
      <$ paddingLeft={10}>
        <div>black text (div)</div>
        <section>green text (nested section following div)</section>
        <section>black text (nested section)</section>
        <div>black text (div)</div>
      </$>
      <section>green text (section following div)</section>
    </$>
  </Story>
</Preview>

`$selector="> div + section"` - Immediate child `<section>` elements that immediately follow `<div>`
elements

<Preview>
  <Story name="Child sibling selector">
    <$ $selector="> div + section" color="green">
      <section>black text (child section preceding div)</section>
      <div>black text (div)</div>
      <$ paddingLeft={10}>
        <div>black text (div)</div>
        <section>black text (nested section following div)</section>
        <section>black text (nested section)</section>
        <div>black text (div)</div>
      </$>
      <section>green text (child section following div)</section>
    </$>
  </Story>
</Preview>

## Comma operator

You can use the comma `,` to specify multiple selectors. Each part of the selector will individually
match descendents of the current element.

`$selector="section, article"` - all section and article descendents of the current element.

<Preview>
  <Story name="Comma operator">
    <>
      <$ $selector="section, article" color="green">
        <div>black text (div)</div>
        <section>green text (section)</section>
        <article>green text (article)</article>
      </$>
      <article>black text (article, outside selector)</article>
    </>
  </Story>
</Preview>

## "Self" (`&`) selector

The ampersand selector refers to the current Stylix element and can be used in a variety of ways.
The most useful is to apply pseudo classes directly to the current element, instead of referring to
descendant elements as they would by default.

The ampersand selector is more likely to be useful when combined with `$inject`.

`$selector="&:hover"` - Hover styles for the current element. Notice that the entire element turns
green on hover, not the individual children.

<Preview>
  <Story name="Hover pseudo class">
    <$ $selector="&:hover" color="green">
      <div>black text / green text on hover</div>
      <div>black text / green text on hover</div>
    </$>
  </Story>
</Preview>

<Preview>
  <Story name="Pseudo class">
    <$ $selector="&:hover" color="green">
      <div>Black text / Green text on hover (div element)</div>
      <$ color="blue">Blue text / Green text on hover (Stylix element)</$>
      <div>Black text / Green text on hover (div element)</div>
    </$>
  </Story>
</Preview>

<Preview>
  <Story name="Element selector">
    <$ $selector="section" color="green">
      <$.section color="blue">Green text (Stylix.section)</$.section>
      <section>Green text (section element)</section>
      <div>
        <section>Green text (nested section element)</section>
      </div>
      <$ color="blue">Blue text (Stylix.div - selector doesn't apply)</$>
      <div>Black text (div element - selector doesn't apply)</div>
    </$>
  </Story>
</Preview>

## Pseudo class "gotcha"

The following is given as an example of a likely mistake in pseudo class usage. Because the selector
refers to all descendants of the current element, the `:last-child` pseudo class is going to apply
to any descendant that is the last child of its parent.

<Preview>
  <Story name=":last-child selector (mistake)">
    <$ $selector=":last-child" color="green">
      <div>Black text</div>
      <$ paddingLeft={10}>
        <div>Black text</div>
        <div>Black text</div>
        <div>Green text (descendant last child)</div>
      </$>
      <div>Black text</div>
      <div>Green text (descendant last child)</div>
    </$>
  </Story>
</Preview>

Instead, you probably should include the `>` to indicate that you only want to apply styles to the
last immediate child of this element:

<Preview>
  <Story name=":last-child selector (correct)">
    <$ $selector="> :last-child" color="green">
      <div>Black text</div>
      <$ paddingLeft={10}>
        <div>Black text</div>
        <div>Black text</div>
        <div>Black text</div>
      </$>
      <div>Black text</div>
      <div>Green text (immediate last child)</div>
    </$>
  </Story>
</Preview>

## Injected selector

The following example injects the selector `&:hover` to each of the child elements instead of
creating a wrapper element. All of the elements should be green on hover

<Preview>
  <Story name="Injected selector">
    <$ $inject $selector="&:hover" color="green">
      <$.section color="blue">Blue text / Green text on hover (Stylix.section)</$.section>
      <section>Black text / Green text on hover (section element)</section>
      <$ color="blue">Blue text (Stylix.div - selector doesn't apply)</$>
      <div>Black text (div element - selector doesn't apply)</div>
    </$>
  </Story>
</Preview>
